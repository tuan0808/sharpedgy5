<div class="create-notification-page"
     [class.mobile]="breakpoint.isMobile"
     [class.tablet]="breakpoint.isTablet"
     [class.desktop]="breakpoint.isDesktop">

    <!-- Header -->
    <div class="page-header" [style.padding-top]="getSafeAreaTop()">
        <div class="header-container">
            <div class="header-content">
                <div class="header-left">
                    <button class="back-button" (click)="goBack()">
                        <i class="bi bi-arrow-left"></i>
                        @if (!breakpoint.isMobile) {
                            <span>Back</span>
                        }
                    </button>
                    <div class="header-info">
                        <h1 class="page-title">{{ getPageTitle() }}</h1>
                        <p class="page-subtitle">{{ getPageSubtitle() }}</p>
                    </div>
                </div>

                @if (breakpoint.isMobile) {
                    <button class="cancel-button-mobile" (click)="cancel()">
                        Cancel
                    </button>
                }
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="(currentStep / totalSteps) * 100"></div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="page-content">
        <div class="content-container">

            <!-- Step 1: Game Selection (only show if not preselected) -->
            @if (shouldShowGameSelection()) {
                <div class="step-content">
                    <div class="step-header">
                        <h2>Select Games to Monitor</h2>
                        <p>Choose which games you want to create notifications for. You can select multiple games.</p>
                    </div>

                    <!-- Game Type Tabs -->
                    <div class="game-tabs" [class.mobile]="breakpoint.isMobile">
                        <button class="tab-button"
                                [class.active]="activeTab === 'upcoming'"
                                (click)="activeTab = 'upcoming'">
                            @if (breakpoint.isMobile) {
                                Upcoming ({{ upcomingGames.length }})
                            } @else {
                                Upcoming Games
                            }
                        </button>
                        <button class="tab-button"
                                [class.active]="activeTab === 'live'"
                                (click)="activeTab = 'live'">
                            @if (breakpoint.isMobile) {
                                Live ({{ activeGames.length }})
                            } @else {
                                Live Games ({{ activeGames.length }})
                            }
                        </button>
                    </div>

                    <!-- Games Grid -->
                    <div class="games-grid" [class.mobile]="breakpoint.isMobile">
                        @for (game of (activeTab === 'upcoming' ? upcomingGames : activeGames); track game.id) {
                            <label class="game-option" [class.selected]="isGameSelected(game.id)">
                                <input type="checkbox"
                                       [checked]="isGameSelected(game.id)"
                                       (change)="toggleGameSelection(game)"
                                       class="game-checkbox">
                                <div class="game-card">
                                    @if (isGameSelected(game.id)) {
                                        <div class="selected-indicator">
                                            <i class="bi bi-check-circle-fill"></i>
                                        </div>
                                    }

                                    <div class="game-matchup">
                                        {{ game.away }} &#64; {{ game.home }}
                                    </div>

                                    <div class="game-details">
                                        <span class="game-time">{{ game.time }}</span>
                                        <span class="game-league">{{ game.league }}</span>
                                    </div>

                                    @if (activeTab === 'live') {
                                        <div class="live-score">
                                            {{ game.awayScore }} - {{ game.homeScore }}
                                        </div>
                                    }
                                </div>
                            </label>
                        }
                    </div>

                    <!-- Selection Summary -->
                    @if (selectedGames.length > 0) {
                        <div class="selection-summary">
                            <h3>{{ selectedGames.length }} game{{ selectedGames.length !== 1 ? 's' : '' }} selected:</h3>
                            <div class="selected-games">
                                @for (game of selectedGames; track game.id) {
                                    <div class="selected-game-chip">
                                        <span>{{ game.away }} &#64; {{ game.home }}</span>
                                        <button class="remove-game" (click)="removeSelectedGame(game)">
                                            <i class="bi bi-x"></i>
                                        </button>
                                    </div>
                                }
                            </div>
                        </div>
                    }
                </div>
            }

            <!-- Step 2: Notification Settings -->
            @if (shouldShowSettings()) {
                <div class="step-content">
                    <div class="step-header">
                        <h2>Configure Notification Settings</h2>
                        <p>These settings will be applied to all {{ selectedGames.length }} selected game{{ selectedGames.length !== 1 ? 's' : '' }}.</p>
                    </div>

                    <div class="settings-layout" [class.mobile]="breakpoint.isMobile">
                        <!-- Notification Type Selection -->
                        <div class="settings-section">
                            <h3>Notification Type</h3>
                            <div class="notification-types">
                                @for (type of notificationTypes; track type) {
                                    <label class="type-option" [class.selected]="selectedNotificationType === type">
                                        <input type="radio"
                                               [value]="type"
                                               [(ngModel)]="selectedNotificationType"
                                               name="notificationType">
                                        <div class="type-card">
                                            <h4>{{ type }}</h4>
                                            <p>
                                                @switch (type) {
                                                    @case ('Point Spread Diff') {Alert when betting lines move significantly}
                                                    @case ('Betting Volume Spike') {Alert when unusual betting activity occurs}
                                                    @case ('Score Update') {Get real-time score notifications}
                                                    @case ('Moneyline Odds') {Alert when moneyline odds change}
                                                    @case ('Over/Under') {Alert when total points line moves}
                                                    @case ('Game Start/End') {Alert when games begin or end}
                                                }
                                            </p>
                                        </div>
                                    </label>
                                }
                            </div>
                        </div>

                        <!-- Preferences -->
                        <div class="settings-section">
                            <h3>Preferences</h3>

                            <div class="setting-group">
                                <label for="sensitivity">Alert Sensitivity</label>
                                <select id="sensitivity"
                                        [(ngModel)]="notificationSettings.sensitivity"
                                        class="form-select">
                                    <option value="low">Low - Only major changes</option>
                                    <option value="medium">Medium - Standard changes</option>
                                    <option value="high">High - Any small change</option>
                                </select>
                            </div>

                            <div class="toggle-settings">
                                <div class="toggle-group">
                                    <input type="checkbox"
                                           id="gameHoursOnly"
                                           [(ngModel)]="notificationSettings.gameHoursOnly">
                                    <label for="gameHoursOnly">Only notify during game hours</label>
                                </div>

                                <div class="toggle-group">
                                    <input type="checkbox"
                                           id="enableImmediately"
                                           [(ngModel)]="notificationSettings.enableImmediately">
                                    <label for="enableImmediately">Enable notifications immediately</label>
                                </div>

                                <div class="toggle-group">
                                    <input type="checkbox"
                                           id="autoDisable"
                                           [(ngModel)]="notificationSettings.autoDisable">
                                    <label for="autoDisable">Auto-disable after game ends</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>

    <!-- Footer Actions -->
    <div class="page-footer" [style.padding-bottom]="getSafeAreaBottom()">
        <div class="footer-container">
            <div class="footer-info">
                @if (shouldShowGameSelection()) {
                    <span>Select games to create notifications for</span>
                }
                @if (shouldShowSettings()) {
                    @if (mode === 'edit') {
                        <span>Updating notification settings</span>
                    } @else {
                        <span>Creating notifications for {{ selectedGames.length }} game{{ selectedGames.length !== 1 ? 's' : '' }}</span>
                    }
                }
            </div>

            <div class="footer-actions" [class.mobile]="breakpoint.isMobile">
                @if (currentStep > 1 && !preselectedGameId) {
                    <button class="btn btn-secondary" (click)="goBack()">
                        <i class="bi bi-chevron-left"></i>
                        Back
                    </button>
                }

                @if (!breakpoint.isMobile) {
                    <button class="btn btn-outline" (click)="cancel()">
                        Cancel
                    </button>
                }

                @if (currentStep < totalSteps && !preselectedGameId) {
                    <button class="btn btn-primary"
                            [disabled]="selectedGames.length === 0"
                            (click)="nextStep()">
                        Next
                        <i class="bi bi-chevron-right"></i>
                    </button>
                } @else {
                    <button class="btn btn-primary" (click)="createNotifications()">
                        @if (mode === 'edit') {
                            Update Notification
                        } @else {
                            Create Notifications
                        }
                    </button>
                }
            </div>
        </div>
    </div>
</div>
