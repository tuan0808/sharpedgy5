<div class="container">
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                @if (!breakpoint.isMobile) {
                    <a href="#" (click)="goBack()">Back</a>
                }
                <div class="header-title">
                    <h1>{{ getPageTitle() }}</h1>
                    <p>{{ getPageSubtitle() }}</p>
                </div>
            </div>
            @if (breakpoint.isMobile) {
                <a href="#" (click)="cancel()">Cancel</a>
            }
        </div>
    </header>

    <main class="main-content">
        <div class="content-wrapper">
            @if (shouldShowGameSelection()) {
                <section class="game-selection">
                    <h2>Select Games to Monitor</h2>
                    <p>Choose which games you want to create notifications for. You can select multiple games.</p>
                    <div class="tabs">
                        <button [class.active]="activeTab === 'upcoming'" (click)="activeTab = 'upcoming'">
                            @if (breakpoint.isMobile) {
                                Upcoming ({{ upcomingGames.length }})
                            } @else {
                                Upcoming Games
                            }
                        </button>
                        <button [class.active]="activeTab === 'live'" (click)="activeTab = 'live'">
                            @if (breakpoint.isMobile) {
                                Live ({{ activeGames.length }})
                            } @else {
                                Live Games ({{ activeGames.length }})
                            }
                        </button>
                    </div>
                    <div class="game-list">
                        @for (game of (activeTab === 'upcoming' ? upcomingGames : activeGames); track game.id) {
                            <div class="game-item">
                                <label>
                                    @if (isGameSelected(game.id)) {
                                        <input type="checkbox" checked (change)="toggleGameSelection(game)">
                                    } @else {
                                        <input type="checkbox" (change)="toggleGameSelection(game)">
                                    }
                                    <div class="game-info">
                                        <p>{{ game.awayTeam }} &#64; {{ game.homeTeam }}</p>
                                        <p>{{ game.scheduledTime }} {{ game.sportType }}</p>
                                    </div>
                                    @if (activeTab === 'live') {
                                        <p>{{ game.awayScore }} - {{ game.homeScore }}</p>
                                    }
                                </label>
                            </div>
                        }
                    </div>
                    @if (selectedGames.length > 0) {
                        <div class="selected-games">
                            <p>{{ selectedGames.length }} game{{ selectedGames.length !== 1 ? 's' : '' }} selected:</p>
                            <ul>
                                @for (game of selectedGames; track game.id) {
                                    <li>
                                        <span>{{ game.awayTeam }} &#64; {{ game.homeTeam }}</span>
                                        <button (click)="removeSelectedGame(game)">Remove</button>
                                    </li>
                                }
                            </ul>
                        </div>
                    }
                </section>
            }

            @if (shouldShowSettings()) {
                <section class="settings">
                    <h2>Configure Notification Settings</h2>
                    <p>These settings will be applied to all {{ selectedGames.length }} selected game{{ selectedGames.length !== 1 ? 's' : '' }}.</p>
                    <div class="notification-types">
                        <h3>Notification Type</h3>
                        <ul>
                            @for (type of notificationTypes; track type) {
                                <li>
                                    <label>
                                        <input type="radio" [(ngModel)]="selectedNotificationType" (ngModelChange)="onNotificationTypeChange()" [value]="type">
                                        {{ type }}
                                        <span>
                                            @switch (type) {
                                                @case ('Point Spread Diff') {Alert when betting lines move significantly}
                                                @case ('Betting Volume Spike') {Alert when unusual betting activity occurs}
                                                @case ('Score Update') {Get real-time score notifications}
                                                @case ('Moneyline Odds') {Alert when moneyline odds change}
                                                @case ('Over/Under') {Alert when total points line moves}
                                                @case ('Game Start/End') {Alert when games begin or end}
                                            }
                                        </span>
                                    </label>
                                </li>
                            }
                        </ul>
                    </div>
                    @switch (selectedNotificationType) {
                        @case ('Point Spread Diff') {
                            <div class="notification-settings">
                                <h3>Configure Notification Settings</h3>
                                <ul>
                                    <li>
                                        <label>Threshold</label>
                                        <input type="number" [(ngModel)]="$any(typeSpecificPreferences).threshold" step="0.5">
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" [(ngModel)]="$any(typeSpecificPreferences).alertOnIncrease">
                                            Alert on Increase
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" [(ngModel)]="$any(typeSpecificPreferences).alertOnDecrease">
                                            Alert on Decrease
                                        </label>
                                    </li>
                                    <li>
                                        <label>Minimum ScheduledGame Time</label>
                                        <select [(ngModel)]="$any(typeSpecificPreferences).minimumGameTime">
                                            <option value="30_MINUTES_BEFORE">30 Minutes Before</option>
                                            <option value="1_HOUR_BEFORE">1 Hour Before</option>
                                            <option value="2_HOURS_BEFORE">2 Hours Before</option>
                                        </select>
                                    </li>
                                </ul>
                            </div>
                        }
                        @case ('Betting Volume Spike') {
                            <div class="notification-settings">
                                <h3>Configure Notification Settings</h3>
                                <ul>
                                    <li>
                                        <label>Volume Threshold</label>
                                        <input type="number" [(ngModel)]="$any(typeSpecificPreferences).volumeThreshold">
                                    </li>
                                    <li>
                                        <label>Time Window</label>
                                        <select [(ngModel)]="$any(typeSpecificPreferences).timeWindow">
                                            <option value="5_MINUTES">5 Minutes</option>
                                            <option value="15_MINUTES">15 Minutes</option>
                                            <option value="30_MINUTES">30 Minutes</option>
                                        </select>
                                    </li>
                                </ul>
                            </div>
                        }
                        @case ('Score Update') {
                            <div class="notification-settings">
                                <h3>Configure Notification Settings</h3>
                                <ul>
                                    <li>
                                        <label>Increment Threshold</label>
                                        <input type="number" [(ngModel)]="$any(typeSpecificPreferences).incrementThreshold">
                                        <p>Alert when score changes by at least this amount</p>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" [(ngModel)]="$any(typeSpecificPreferences).realTimeUpdates">
                                            Real-time Updates
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" [(ngModel)]="$any(typeSpecificPreferences).onlySignificantScores">
                                            Only Significant Scores
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" [(ngModel)]="$any(typeSpecificPreferences).quarterEnd">
                                            Quarter End
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" [(ngModel)]="$any(typeSpecificPreferences).halfTime">
                                            Half Time
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" [(ngModel)]="$any(typeSpecificPreferences).periodEnd">
                                            Period End
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" [(ngModel)]="$any(typeSpecificPreferences).overtime">
                                            Overtime
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" [(ngModel)]="$any(typeSpecificPreferences).twoMinuteWarning">
                                            Two Minute Warning
                                        </label>
                                    </li>
                                </ul>
                            </div>
                        }
                        @case ('Moneyline Odds') {
                            <div class="notification-settings">
                                <h3>Configure Notification Settings</h3>
                                <ul>
                                    <li>
                                        <label>Threshold</label>
                                        <input type="number" [(ngModel)]="$any(typeSpecificPreferences).threshold" step="5">
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" [(ngModel)]="$any(typeSpecificPreferences).trackFavoriteShift">
                                            Track Favorite Shift
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" [(ngModel)]="$any(typeSpecificPreferences).trackUnderdogShift">
                                            Track Underdog Shift
                                        </label>
                                    </li>
                                    <li>
                                        <label>Minimum Odds Value</label>
                                        <input type="number" [(ngModel)]="$any(typeSpecificPreferences).minimumOddsValue" step="10">
                                    </li>
                                </ul>
                            </div>
                        }
                        @case ('Over/Under') {
                            <div class="notification-settings">
                                <h3>Configure Notification Settings</h3>
                                <ul>
                                    <li>
                                        <label>Threshold</label>
                                        <input type="number" [(ngModel)]="$any(typeSpecificPreferences).threshold" step="0.5">
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" [(ngModel)]="$any(typeSpecificPreferences).alertOnIncrease">
                                            Alert on Increase
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" [(ngModel)]="$any(typeSpecificPreferences).alertOnDecrease">
                                            Alert on Decrease
                                        </label>
                                    </li>
                                </ul>
                            </div>
                        }
                        @case ('Game Start/End') {
                            <div class="notification-settings">
                                <h3>Configure Notification Settings</h3>
                                <ul>
                                    <li>
                                        <label>
                                            <input type="checkbox" [(ngModel)]="$any(typeSpecificPreferences).gameStart">
                                            Alert on ScheduledGame Start
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" [(ngModel)]="$any(typeSpecificPreferences).gameEnd">
                                            Alert on ScheduledGame End
                                        </label>
                                    </li>
                                    <li>
                                        <label>
                                            <input type="checkbox" [(ngModel)]="$any(typeSpecificPreferences).includeStats">
                                            Include Stats in Final Score
                                        </label>
                                    </li>
                                    <li>
                                        <label>Pre-ScheduledGame Reminder</label>
                                        <select [(ngModel)]="$any(typeSpecificPreferences).preGameReminder">
                                            <option [value]="null">None</option>
                                            <option value="15_MINUTES">15 Minutes Before</option>
                                            <option value="30_MINUTES">30 Minutes Before</option>
                                            <option value="1_HOUR">1 Hour Before</option>
                                        </select>
                                    </li>
                                    <li>
                                        <label>Final Score Delay</label>
                                        <select [(ngModel)]="$any(typeSpecificPreferences).finalScoreDelay">
                                            <option [value]="null">Immediate</option>
                                            <option value="2_MINUTES">2 Minutes After</option>
                                            <option value="5_MINUTES">5 Minutes After</option>
                                        </select>
                                    </li>
                                </ul>
                            </div>
                        }
                    }
                    <div class="common-settings">
                        <h3>Preferences</h3>
                        <ul>
                            <li>
                                <label>
                                    <input type="checkbox" [(ngModel)]="notificationSettings.gameHoursOnly">
                                    Only notify during game hours
                                </label>
                            </li>
                            <li>
                                <label>
                                    <input type="checkbox" [(ngModel)]="notificationSettings.enableImmediately">
                                    Enable notifications immediately
                                </label>
                            </li>
                            <li>
                                <label>
                                    <input type="checkbox" [(ngModel)]="notificationSettings.autoDisable">
                                    Auto-disable after game ends
                                </label>
                            </li>
                        </ul>
                    </div>
                </section>
            }
        </div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <p>
                @if (shouldShowGameSelection()) {
                    Select games to create notifications for
                }
                @if (shouldShowSettings()) {
                    @if (mode === 'edit') {
                        Updating notification settings
                    } @else {
                        Creating notifications for {{ selectedGames.length }} game{{ selectedGames.length !== 1 ? 's' : '' }}
                    }
                }
            </p>
            <div class="footer-actions">
                @if (currentStep > 1 && !preselectedGameId) {
                    <button (click)="goBack()">Back</button>
                }
                @if (!breakpoint.isMobile) {
                    <button (click)="cancel()">Cancel</button>
                }
                @if (currentStep < totalSteps && !preselectedGameId) {
                    <button (click)="nextStep()">Next</button>
                } @else {
                    <button (click)="createNotifications()">
                        @if (mode === 'edit') {
                            Update Notification
                        } @else {
                            Create Notifications
                        }
                    </button>
                }
            </div>
        </div>
    </footer>
</div>
