<div class="modal-header bg-dark text-white">
    <h4 class="modal-title">Place Bet</h4>
    <button type="button" class="btn-close btn-close-white" (click)="activeModal.dismiss()"></button>
</div>
<div class="modal-body bg-light">
    <form [formGroup]="betForm" (ngSubmit)="onSubmit()" class="bet-form">
        <!-- Bet Type Selection -->
        <div class="bet-type-selection mb-4">
            <div class="btn-group w-100" role="group">
                @for (betType of Object.values(BetTypes); track betType) {
                    <input type="radio"
                           class="btn-check"
                           [value]="betType"
                           formControlName="betType"
                           [id]="betType">
                    <label class="btn btn-outline-primary" [for]="betType">
                        {{betTypeLabels[betType]}}
                    </label>
                }
            </div>
        </div>

        <!-- Team Selection -->
        @if (betForm.get('betType')?.value) {
            <div class="team-selection mb-4">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        Select Team
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-6">
                                <div class="team-option h-100">
                                    <input type="radio"
                                           class="btn-check"
                                           [value]="game.homeTeam.name"
                                           formControlName="selectedTeam"
                                           id="homeTeam">
                                    <label class="btn btn-outline-dark w-100 h-100 d-flex flex-column align-items-center justify-content-center"
                                           for="homeTeam">
                                        <span class="team-name">{{game.homeTeam.name}}</span>
                                        @if (betForm.get('betType')?.value === BetTypes.MONEYLINE) {
                                            <span class="odds" [class.text-success]="game.moneylineHome > 0"
                                                  [class.text-danger]="game.moneylineHome < 0">
                                                {{game.moneylineHome >= 0 ? '+' : ''}}{{game.moneylineHome}}
                                            </span>
                                        }
                                        @if (betForm.get('betType')?.value === BetTypes.POINT_SPREAD) {
                                            <span class="odds">
                                                {{game.spread >= 0 ? '+' : ''}}{{game.spread}}
                                            </span>
                                        }
                                    </label>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="team-option h-100">
                                    <input type="radio"
                                           class="btn-check"
                                           [value]="game.awayTeam.name"
                                           formControlName="selectedTeam"
                                           id="awayTeam">
                                    <label class="btn btn-outline-dark w-100 h-100 d-flex flex-column align-items-center justify-content-center"
                                           for="awayTeam">
                                        <span class="team-name">{{game.awayTeam.name}}</span>
                                        @if (betForm.get('betType')?.value === BetTypes.MONEYLINE) {
                                            <span class="odds" [class.text-success]="game.moneylineAway > 0"
                                                  [class.text-danger]="game.moneylineAway < 0">
                                                {{game.moneylineAway >= 0 ? '+' : ''}}{{game.moneylineAway}}
                                            </span>
                                        }
                                        @if (betForm.get('betType')?.value === BetTypes.POINT_SPREAD) {
                                            <span class="odds">
                                                {{-game.spread >= 0 ? '+' : ''}}{{-game.spread}}
                                            </span>
                                        }
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }

        <!-- Over/Under Selection -->
        @if (betForm.get('selectedTeam')?.value && betForm.get('betType')?.value === BetTypes.OVER_UNDER) {
            <div class="mb-4">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        Over/Under ({{game.overUnderTotal}})
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-6">
                                <input type="radio"
                                       class="btn-check"
                                       [value]="game.overUnderTotal"
                                       formControlName="wagerValue"
                                       id="over">
                                <label class="btn btn-outline-dark w-100" for="over">
                                    Over {{game.overUnderTotal}}
                                </label>
                            </div>
                            <div class="col-6">
                                <input type="radio"
                                       class="btn-check"
                                       [value]="-game.overUnderTotal"
                                       formControlName="wagerValue"
                                       id="under">
                                <label class="btn btn-outline-dark w-100" for="under">
                                    Under {{game.overUnderTotal}}
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }

        <!-- Hidden inputs for Point Spread and Moneyline -->
        @if (betForm.get('selectedTeam')?.value) {
            @if (betForm.get('betType')?.value === BetTypes.POINT_SPREAD) {
                <input type="hidden"
                       formControlName="wagerValue"
                       [value]="betForm.get('selectedTeam')?.value === game.homeTeam.name ? game.spread : -game.spread">
            }
            @if (betForm.get('betType')?.value === BetTypes.MONEYLINE) {
                <input type="hidden"
                       formControlName="wagerValue"
                       [value]="selectedTeamMoneyline">
            }
        }

        <!-- Wager Amount Input -->
        @if (betForm.get('selectedTeam')?.value) {
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    Place Your Bet
                </div>
                <div class="card-body">
                    <div class="row align-items-end">
                        <div class="col">
                            <label class="form-label">Bet Amount ($)</label>
                            <input type="number"
                                   class="form-control form-control-lg"
                                   formControlName="wagerAmount"
                                   placeholder="Enter amount"
                                   [min]="0"
                                   [max]="5000"
                                   (input)="calculatePotentialWinnings()">
                            @if (betForm.get('wagerAmount')?.touched && betForm.get('wagerAmount')?.errors?.['required']) {
                                <div class="text-danger mt-1">Amount is required</div>
                            }
                            @if (betForm.get('wagerAmount')?.touched && betForm.get('wagerAmount')?.errors?.['min']) {
                                <div class="text-danger mt-1">Amount must be greater than 0</div>
                            }
                            @if (betForm.get('wagerAmount')?.touched && betForm.get('wagerAmount')?.errors?.['max']) {
                                <div class="text-danger mt-1">Amount must be less than 5000</div>
                            }
                            @if (betForm.get('wagerAmount')?.touched && betForm.get('wagerAmount')?.errors?.['insufficientFunds']) {
                                <div class="text-danger mt-1">Insufficient funds (Balance: {{currentBalance | currency}})</div>
                            }
                        </div>
                    </div>

                    <!-- Potential Winnings Display -->
                    @if (betForm.valid && potentialWinnings > 0) {
                        <div class="alert alert-success mt-3 mb-0">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>Potential Winnings:</span>
                                <span class="h4 mb-0">{{potentialWinnings | currency}}</span>
                            </div>
                        </div>
                    }
                </div>
            </div>
        }
    </form>
</div>
<div class="modal-footer">
    <button type="button"
            class="btn btn-secondary"
            (click)="activeModal.dismiss()">
        Cancel
    </button>
    <button type="submit"
            class="btn btn-primary"
            [disabled]="!betForm.valid"
            (click)="onSubmit()">
        Place Bet
    </button>
</div>
