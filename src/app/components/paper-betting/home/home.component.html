<!-- home.component.html -->
<div class="header">
    <h1>Bet Simulator</h1>
    <div class="right">
        <span class="balance">
      <i class="bi bi-wallet2"></i> {{balance().remainingCredit }} / {{balance().totalCredit}}
    </span>
        <span class="balance">
      <i class="bi bi-wallet2"></i> {{balance().balance }}
    </span>
        <i class="bi bi-bell notification"></i>
    </div>
</div>

<div class="top-container">
    <div class="sports-scroll border-bottom card">
        <div class="container-fluid px-4 position-relative">
            <div class="d-flex overflow-auto py-2">
                @for (sport of sports(); track sport.name) {
                    <button class="btn sport-tab"
                            [class.active]="selectedSport() === sport.type"
                            (click)="onSportSelect(sport.type)"
                            [disabled]="isLoading()">
                        {{ sport.icon }}{{ sport.name }}<span class="badge"></span>
                    </button>
                }
            </div>
        </div>
    </div>
</div>

<div class="games-container">
    <div class="games-header">
        <h2 class="title">Today's Games</h2>
        <!-- Show total count and pagination info -->
        @if (!isLoading() && !hasError() && totalElements() > 0) {
            <div class="games-info">
                <small class="text-muted">
                    Showing {{ ((currentPage() - 1) * pageSize() + 1) }} to
                    {{ Math.min(currentPage() * pageSize(), totalElements()) }}
                    of {{ totalElements() }} games
                </small>
            </div>
            <app-pagination
                    [currentPage]="currentPage()"
                    [totalPages]="totalPages()"
                    [pageSize]="pageSize()"
                    (pageChange)="onPageChange($event)"
                    (pageSizeChange)="onPageSizeChange($event)">
            </app-pagination>
        }
    </div>

    @if (isLoading()) {
        <div class="loading-container">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p>Loading games...</p>
        </div>
    } @else if (hasError()) {
        <div class="error-container">
            <div class="alert alert-danger" role="alert">
                <i class="bi bi-exclamation-triangle-fill"></i>
                {{ errorMessage() }}
            </div>
            <button class="btn btn-primary mt-3" (click)="onRetry()">
                <i class="bi bi-arrow-clockwise"></i> Retry
            </button>
        </div>
    } @else if (displayedGames().length === 0 && totalElements() === 0) {
        <div class="empty-container">
            <p>No games available at the moment.</p>
        </div>
    } @else {
        <div class="games">
            @for (game of displayedGames(); track game.id) {
                <app-game-card
                        [sportType]="selectedSport()"
                        [gameData]="game">
                </app-game-card>
            }
        </div>

        <!-- Only show footer pagination if there are multiple pages -->
        @if (totalPages() > 1) {
            <div class="games-footer">
                <app-pagination
                        [currentPage]="currentPage()"
                        [totalPages]="totalPages()"
                        [pageSize]="pageSize()"
                        (pageChange)="onPageChange($event)"
                        (pageSizeChange)="onPageSizeChange($event)">
                </app-pagination>
            </div>
        }
    }
</div>

<!-- Scroll to top button, only shown when not at top -->
@if (!isAtTop()) {
    <button class="btn btn-primary scroll-to-top" (click)="scrollToTop()">
        <i class="bi bi-arrow-up"></i>
    </button>
}
