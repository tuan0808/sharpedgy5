<div class="leaderboard-container">
    <!-- Header -->
    <header class="page-header">
        <div class="header-content">
            <h1 class="page-title">
                <i class="bi bi-trophy-fill"></i>
                Player Rankings
            </h1>
            <div class="period-tabs" *ngIf="screenWidth >= 768">
                <button *ngFor="let period of filterPeriods"
                        class="period-tab"
                        [class.active]="activePeriod === period"
                        (click)="setActivePeriod(period)">
                    {{ period }}
                </button>
            </div>
            <div class="mobile-period-select" *ngIf="screenWidth < 768">
                <select [(ngModel)]="activePeriod" (ngModelChange)="setActivePeriod($event)" class="period-select">
                    <option *ngFor="let period of filterPeriods" [value]="period">{{ period }}</option>
                </select>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Controls Bar -->
        <div class="controls-bar">
            <div class="entries-control">
                <span>Show</span>
                <select class="entries-select" [(ngModel)]="pageSize" (ngModelChange)="setPageSize($event)">
                    <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }}</option>
                </select>
                <span>entries</span>
            </div>
            <div class="search-control">
                <i class="bi bi-search"></i>
                <input type="text"
                       class="search-input"
                       [(ngModel)]="searchTerm"
                       (ngModelChange)="onSearch($event)"
                       placeholder="Search players...">
            </div>
        </div>

        <!-- Desktop Table Header -->
        <div class="table-header" *ngIf="screenWidth >= 768">
            <div class="header-cell rank-col">Rank</div>
            <div class="header-cell username-col">Player</div>
            <div class="header-cell wins-col">Wins</div>
            <div class="header-cell losses-col">Losses</div>
            <div class="header-cell winrate-col">Win Rate</div>
            <div class="header-cell returns-col">Returns</div>
            <div class="header-cell expand-col"></div>
        </div>

        <!-- Players List -->
        <div class="players-list">
            <div class="player-item" *ngFor="let user of filteredUsers; let i = index">
                <!-- Desktop Row -->
                <div class="player-row" *ngIf="screenWidth >= 768" (click)="toggleAccordion(user.id)">
                    <div class="cell rank-col">
                        <span class="rank-badge" [ngClass]="{
                            'rank-1': (user.rank || (i + 1 + page * pageSize)) === 1,
                            'rank-2': (user.rank || (i + 1 + page * pageSize)) === 2,
                            'rank-3': (user.rank || (i + 1 + page * pageSize)) === 3,
                            'top-10': (user.rank || (i + 1 + page * pageSize)) > 3 && (user.rank || (i + 1 + page * pageSize)) <= 10
                        }">
                            <i class="bi bi-trophy-fill" *ngIf="(user.rank || (i + 1 + page * pageSize)) <= 3"></i>
                            {{ user.rank || (i + 1 + page * pageSize) }}
                        </span>
                    </div>
                    <div class="cell username-col">
                        <span class="username">{{ user.username }}</span>
                    </div>
                    <div class="cell wins-col">
                        <span class="stat-value wins">{{ user.betWins || 0 }}</span>
                    </div>
                    <div class="cell losses-col">
                        <span class="stat-value losses">{{ user.betLosses || 0 }}</span>
                    </div>
                    <div class="cell winrate-col">
                        <span class="win-rate" [ngClass]="{'high-rate': user.winRate >= 70}">
                            {{ user.winRate ? (user.winRate | number:'1.1-1') + '%' : '0%' }}
                        </span>
                    </div>
                    <div class="cell returns-col">
                        <span class="returns" [ngClass]="{
                            'positive': user.totalAmount > 0,
                            'negative': user.totalAmount < 0
                        }">
                            {{ user.totalAmount ? formatCurrency(user.totalAmount) : '$0.00' }}
                        </span>
                    </div>
                    <div class="cell expand-col">
                        <i class="bi bi-chevron-down expand-icon" [class.rotated]="isRowSelected(user.id)"></i>
                    </div>
                </div>

                <!-- Mobile Card -->
                <div class="player-card" *ngIf="screenWidth < 768" (click)="toggleAccordion(user.id)">
                    <div class="card-top">
                        <span class="rank-badge" [ngClass]="{
                            'rank-1': (user.rank || (i + 1 + page * pageSize)) === 1,
                            'rank-2': (user.rank || (i + 1 + page * pageSize)) === 2,
                            'rank-3': (user.rank || (i + 1 + page * pageSize)) === 3,
                            'top-10': (user.rank || (i + 1 + page * pageSize)) > 3 && (user.rank || (i + 1 + page * pageSize)) <= 10
                        }">
                            <i class="bi bi-trophy-fill" *ngIf="(user.rank || (i + 1 + page * pageSize)) <= 3"></i>
                            {{ user.rank || (i + 1 + page * pageSize) }}
                        </span>
                        <span class="username">{{ user.username }}</span>
                        <i class="bi bi-chevron-down expand-icon" [class.rotated]="isRowSelected(user.id)"></i>
                    </div>
                    <div class="card-stats">
                        <div class="stat-group">
                            <span class="stat-label">W/L</span>
                            <span class="stat-value">{{ user.betWins || 0 }}/{{ user.betLosses || 0 }}</span>
                        </div>
                        <div class="stat-group">
                            <span class="stat-label">Win Rate</span>
                            <span class="stat-value">{{ user.winRate ? (user.winRate | number:'1.1-1') + '%' : '0%' }}</span>
                        </div>
                        <div class="stat-group">
                            <span class="stat-label">Returns</span>
                            <span class="stat-value" [ngClass]="{
                                'positive': user.totalAmount > 0,
                                'negative': user.totalAmount < 0
                            }">{{ user.totalAmount ? formatCurrency(user.totalAmount) : '$0.00' }}</span>
                        </div>
                    </div>
                </div>

                <!-- Expanded Details -->
                <div class="player-details" [class.expanded]="isRowSelected(user.id)">
                    <div class="details-content">
                        <!-- Statistics Section -->
                        <div class="stats-section">
                            <h3 class="section-title">Betting Statistics</h3>
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <i class="bi bi-cash-stack"></i>
                                    </div>
                                    <div class="stat-info">
                                        <span class="stat-label">Avg Bet</span>
                                        <span class="stat-value">{{ user.statistics.avgBetAmount ? formatCurrency(user.statistics.avgBetAmount) : '$0.00' }}</span>
                                    </div>
                                </div>
                                <div class="stat-card highlight">
                                    <div class="stat-icon">
                                        <i class="bi bi-star-fill"></i>
                                    </div>
                                    <div class="stat-info">
                                        <span class="stat-label">Highest Win</span>
                                        <span class="stat-value">{{ user.statistics.highestWin ? formatCurrency(user.statistics.highestWin) : '$0.00' }}</span>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <i class="bi bi-graph-up"></i>
                                    </div>
                                    <div class="stat-info">
                                        <span class="stat-label">Avg Odds</span>
                                        <span class="stat-value">{{ user.statistics.avgOdds ? (user.statistics.avgOdds | number:'1.2-2') : '0.00' }}</span>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <i class="bi bi-heart-fill"></i>
                                    </div>
                                    <div class="stat-info">
                                        <span class="stat-label">Favorite</span>
                                        <span class="stat-value">{{ user.statistics.favoriteCategory || 'N/A' }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Bets Section -->
                        <div class="recent-bets-section">
                            <h3 class="section-title">Recent Bets</h3>
                            <div class="bets-table">
                                <div class="bets-scroll">
                                    <table class="bets-data">
                                        <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Game</th>
                                            <th>Team</th>
                                            <th>Wager</th>
                                            <th>Odds</th>
                                            <th>Status</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr *ngFor="let bet of user.lastBets">
                                            <td>{{ bet.date }}</td>
                                            <td>{{ bet.gameName }}</td>
                                            <td>{{ bet.selectedTeam }}</td>
                                            <td>{{ formatCurrency(bet.wagerAmount) }}</td>
                                            <td>{{ formatCurrency(bet.wagerValue) }}</td>
                                            <td>
                                                    <span class="status-badge" [ngClass]="{
                                                        'status-won': bet.status.toLowerCase() === 'won',
                                                        'status-lost': bet.status.toLowerCase() === 'lost',
                                                        'status-pending': bet.status.toLowerCase() === 'pending'
                                                    }">{{ bet.status }}</span>
                                            </td>
                                        </tr>
                                        <tr *ngIf="!user.lastBets || user.lastBets.length === 0">
                                            <td colspan="6" class="no-data">No recent bets available</td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Current User Section (if exists) -->
            <div class="player-item current-user" *ngIf="currentUser">
                <!-- Similar structure as above but with "current-user" class -->
                <!-- Desktop Row -->
                <div class="player-row" *ngIf="screenWidth >= 768" (click)="toggleCurrentUserAccordion()">
                    <div class="cell rank-col">
                        <span class="rank-badge" [ngClass]="{
                            'rank-1': currentUser.rank === 1,
                            'rank-2': currentUser.rank === 2,
                            'rank-3': currentUser.rank === 3,
                            'top-10': currentUser.rank > 3 && currentUser.rank <= 10
                        }">
                            <i class="bi bi-trophy-fill" *ngIf="currentUser.rank <= 3"></i>
                            {{ currentUser.rank || 'N/A' }}
                        </span>
                    </div>
                    <div class="cell username-col">
                        <span class="username">{{ currentUser.username }} <span class="you-badge">You</span></span>
                    </div>
                    <div class="cell wins-col">
                        <span class="stat-value wins">{{ currentUser.betWins || 0 }}</span>
                    </div>
                    <div class="cell losses-col">
                        <span class="stat-value losses">{{ currentUser.betLosses || 0 }}</span>
                    </div>
                    <div class="cell winrate-col">
                        <span class="win-rate" [ngClass]="{'high-rate': currentUser.winRate >= 70}">
                            {{ currentUser.winRate ? (currentUser.winRate | number:'1.1-1') + '%' : '0%' }}
                        </span>
                    </div>
                    <div class="cell returns-col">
                        <span class="returns" [ngClass]="{
                            'positive': currentUser.totalAmount > 0,
                            'negative': currentUser.totalAmount < 0
                        }">
                            {{ currentUser.totalAmount ? formatCurrency(currentUser.totalAmount) : '$0.00' }}
                        </span>
                    </div>
                    <div class="cell expand-col">
                        <i class="bi bi-chevron-down expand-icon" [class.rotated]="expandedCurrentUser"></i>
                    </div>
                </div>

                <!-- Expanded details for current user (similar structure) -->
                <div class="player-details" [class.expanded]="expandedCurrentUser">
                    <!-- Same structure as above -->
                </div>
            </div>
        </div>

        <!-- Pagination Footer -->
        <div class="table-footer">
            <div class="footer-info">
                Showing {{ paginationStart }} to {{ paginationEnd }} of {{ totalElements }} entries
            </div>
            <div class="pagination">
                <button class="page-btn" (click)="prevPage()" [disabled]="page === 0">
                    <i class="bi bi-chevron-left"></i>
                    Previous
                </button>
                <div class="page-numbers">
                    <button class="page-btn"
                            *ngFor="let p of getPageNumbers()"
                            [class.active]="p === page + 1"
                            (click)="page = p - 1; loadLeaderboard()">
                        {{ p }}
                    </button>
                </div>
                <button class="page-btn" (click)="nextPage()" [disabled]="!hasNextPage">
                    Next
                    <i class="bi bi-chevron-right"></i>
                </button>
            </div>
        </div>
    </main>
</div>
