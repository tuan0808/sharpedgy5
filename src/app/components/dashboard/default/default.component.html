<div class="gridster-wrapper">
    <!-- Fixed-height header -->
    <div class="dashboard-header">
        @if (currentDashboard()) {
            <h1>{{ currentDashboard()?.name }}</h1>
        }

        <!-- Undo/Redo buttons -->
        @if (!popupWindow() && auth.isAuthenticated()) {
            <div class="btn-group">
                <button class="btn" [class.btn-primary]="canUndo()" [class.btn-secondary]="!canUndo()"
                        [disabled]="!canUndo()" (click)="undo()"
                        [title]="canUndo() ? 'Undo last action' : 'No more actions to undo'">
                    <i class="icofont icofont-undo" [class.text-muted]="!canUndo()"></i>
                </button>
                <button class="btn" [class.btn-primary]="canRedo()" [class.btn-secondary]="!canRedo()"
                        [disabled]="!canRedo()" (click)="redo()"
                        [title]="canRedo() ? 'Redo last action' : 'No more actions to redo'">
                    <i class="icofont icofont-redo" [class.text-muted]="!canRedo()"></i>
                </button>
            </div>
        }

        <!-- Action buttons -->
        @if (auth.isAuthenticated()) {
            <div class="btn-group">
                <button class="btn btn-primary" (click)="saveDashboardState()">
                    <i class="icofont icofont-save"></i>
                </button>
                <button class="btn btn-secondary" (click)="toggleGrid()">
                    <i class="icofont icofont-grid-advance"></i>
                </button>
                <button class="btn btn-primary" (click)="openPopupGrid()">
                    <i class="icofont icofont-external-link"></i>
                </button>
            </div>
        }
    </div>

    <!-- Main content area -->
    @if (toggleAnalytics) {
        <app-analytics-chart></app-analytics-chart>
    } @else {
        <div class="gridster-container">
            <gridster [options]="getGridOptions()" (dragover)="$event.preventDefault()" (drop)="onDrop($event)">
                @for (item of gridItems(); track item.id) {
                    <gridster-item [item]="item">
                        <ng-template appDynamicComponent></ng-template>
                    </gridster-item>
                }
            </gridster>
        </div>
    }
</div>
