<!-- prediction-form.component.html -->
<div class="betting-card">
    <h2 *ngIf="!showConfirmation">Place Your Bet</h2>
    <h2 *ngIf="showConfirmation">Confirm Your Bet</h2>

    <!-- Form View -->
    <div *ngIf="!showConfirmation">
        <div class="layout-container">
            <!-- Left Side - Bet Types -->
            <div class="bet-types">
                <h3>Bet Type</h3>
                <div class="bet-type-list">
                    @for (bet of betTypes; track bet.id) {
                        <button
                                [ngClass]="bet.isEnabled ? '' : 'disabled'"
                                type="button"
                                (click)="setSelectedBetType(bet.id)"
                                [class.selected]="selectedBetType === bet.id"
                                class="bet-type-btn"
                        >
                            <span class="bet-icon">{{ bet.icon }}</span>
                            <span>{{ bet.label }}</span>
                        </button>
                    }
                </div>
            </div>

            <!-- Right Side - Form -->
            <form [formGroup]="bettingForm" (ngSubmit)="onSubmit()" class="bet-form">
                <div class="form-section">
                    <label>Select Team</label>
                    <div class="team-grid">
                        <!-- Home Team -->
                        <button
                                type="button"
                                (click)="setSelectedTeam({
                name: game.homeTeam.name,
                odds: game.moneylineHome,
                type: 'home'
              })"
                                [class.selected]="selectedTeam?.type === 'home'"
                                class="team-btn"
                        >
                            <div class="team-name">{{ game.homeTeam.name }}</div>
                            <div class="team-odds">
                                {{ game.moneylineHome | americanOdds }}
                            </div>
                            <div class="team-probability">
                                {{ homeTeamWinProbability.toFixed(2) }}% chance to win
                            </div>
                        </button>
                        <!-- Away Team -->
                        <button
                                type="button"
                                (click)="setSelectedTeam({
                name: game.awayTeam.name,
                odds: game.moneylineAway,
                type: 'away'
              })"
                                [class.selected]="selectedTeam?.type === 'away'"
                                class="team-btn"
                        >
                            <div class="team-name">{{ game.awayTeam.name }}</div>
                            <div class="team-odds">
                                {{ game.moneylineAway | americanOdds }}
                            </div>
                            <div class="team-probability">
                                {{ awayTeamWinProbability.toFixed(2) }}% chance to win
                            </div>
                        </button>
                    </div>
                </div>

                <div class="form-section">
                    <label for="betAmount">Bet Amount ($)</label>
                    <div class="amount-input">
                        <span class="dollar-sign">$</span>
                        <input
                                id="betAmount"
                                type="number"
                                formControlName="amount"
                                placeholder="Enter amount"
                                (input)="updatePotentialWinnings()"
                        />
                    </div>
                    @if (bettingForm.get('amount')?.errors?.['max']) {
                        <div class="error-message">Maximum bet amount is $5000</div>
                    }
                    @if (bettingForm.get('amount')?.errors?.['min']) {
                        <div class="error-message">Minimum bet amount is $0</div>
                    }
                </div>

                <!-- Confidence Slider -->
                <div class="form-section">
                    <label for="confidenceSlider">Confidence Level</label>
                    <div class="slider-container">
                        <mdb-range
                                formControlName="confidence"
                                [min]="0"
                                [max]="100"
                                [id]="'confidenceSlider'"
                        ></mdb-range>
                        <div class="confidence-display">
                            Confidence Level: {{ bettingForm.get('confidence')?.value }}%
                        </div>
                    </div>
                </div>

                <!-- Notes Text Area -->
                <div class="form-section notes-section">
                    <label for="notes">Notes</label>
                    <textarea
                            id="notes"
                            formControlName="notes"
                            placeholder="Enter additional notes about your bet"
                            class="notes-textarea"
                            rows="3"
                    ></textarea>
                </div>

                <!-- Potential Winnings Display -->
                @if (potentialWinnings > 0) {
                    <div class="potential-winnings">
                        <div class="winnings-info">
                            <span>Potential Winnings:</span>
                            <span class="amount">${{ potentialWinnings.toFixed(2) }}</span>
                        </div>
                    </div>
                }

                <button type="submit" class="place-bet-btn" [disabled]="!isFormValid()">
                    Review Bet
                </button>
            </form>
        </div>
    </div>

    <!-- Confirmation View -->
    <div *ngIf="showConfirmation" class="confirmation-view">
        <div class="confirmation-details">
            <h3>Bet Details</h3>
            <div class="detail-row">
                <span class="label">Game:</span>
                <span class="value">{{ submittedBetData?.betHistory.homeTeam }} vs {{ submittedBetData?.betHistory.awayTeam }}</span>
            </div>
            <div class="detail-row">
                <span class="label">Bet Type:</span>
                <span class="value">{{ submittedBetData?.betHistory.betType }}</span>
            </div>
            <div class="detail-row">
                <span class="label">Selected Team:</span>
                <span class="value">{{ submittedBetData?.betHistory.selectedTeam }}</span>
            </div>
            <div class="detail-row">
                <span class="label">Odds:</span>
                <span class="value">{{ submittedBetData?.betHistory.wagerValue | americanOdds }}</span>
            </div>
            <div class="detail-row">
                <span class="label">Win Probability:</span>
                <span class="value">
          {{ (submittedBetData?.betHistory.selectedTeam === game.homeTeam.name ? homeTeamWinProbability : awayTeamWinProbability).toFixed(2) }}%
        </span>
            </div>
            <div class="detail-row">
                <span class="label">Bet Amount:</span>
                <span class="value">${{ submittedBetData?.betHistory.amount }}</span>
            </div>
            <div class="detail-row">
                <span class="label">Potential Winnings:</span>
                <span class="value">${{ submittedBetData?.betHistory.potentialWinnings.toFixed(2) }}</span>
            </div>
            <div class="detail-row">
                <span class="label">Confidence Level:</span>
                <span class="value">{{ formatConfidence(JSON.parse(submittedBetData?.betHistory.comment).confidence) }}</span>
            </div>
            <div class="detail-row">
                <span class="label">Notes:</span>
                <span class="value">{{ JSON.parse(submittedBetData?.betHistory.comment).notes || 'None' }}</span>
            </div>
            <div class="detail-row">
                <span class="label">Control Note:</span>
                <span class="value">{{ submittedBetData?.betHistory.controlNote }}</span>
            </div>
        </div>

        <div class="confirmation-prompt">
            <p>Is this information correct?</p>
            <div class="confirmation-buttons">
                <button class="edit-btn" (click)="editBet()">Edit</button>
                <button class="confirm-btn" (click)="confirmBet()">Confirm</button>
            </div>
        </div>
    </div>
</div>
